kind: pipeline
name: default

steps:
  - name: restore
    image: plugins/s3-cache
    settings:
      pull: true
#      endpoint: <ENDPOINT>
#      access_key: <ACCESS_KEY>
#      secret_key: <SECRET_KEY>
      restore: true

  - name: test
    image: ruby
    commands:
      - bundle update --bundler
      - bundle install --path vendor/bundle
      - bundle exec rspec

  - name: rebuild
      image: plugins/s3-cache
      settings:
        pull: true
#        endpoint: <ENDPOINT>
#        access_key: <ACCESS_KEY>
#        secret_key: <SECRET_KEY>
        rebuild: true
        mount:
          - vendor/bundle


  - name: textlint
    image: node
    commands:
      - npm install textlint
      - npm install textlint-rule-preset-ja-technical-writing
      - $(npm bin)/textlint --format pretty-error --preset ja-technical-writing README.md
